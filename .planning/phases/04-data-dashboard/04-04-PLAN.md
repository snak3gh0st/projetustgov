---
phase: 04-data-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Dashboard displays row counts per entity table"
    - "Extraction history visible on home page showing last 30 days of pipeline runs"
    - "Data tables are browsable with search, sort, and filter"
    - "Dashboard shows data freshness"
    - "Propostas can be explored with related entities"
    - "CSV export works on each data table"
    - "Portuguese characters render correctly"
    - "Sidebar has exactly 5 tabs: Home, Propostas, Programas, Apoiadores, Emendas"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Streamlit dashboard by running it locally and confirming all success criteria from the phase definition are met: metrics cards, entity browsing, cross-filtering, CSV export, extraction history (on home page), data freshness, and Portuguese character rendering.

Purpose: Visual and functional verification that cannot be automated â€” confirms the dashboard works as intended from a user's perspective.

Output: User confirmation that the dashboard meets all success criteria.
</objective>

<execution_context>
@/Users/pauloloureiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pauloloureiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-data-dashboard/04-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete PROJETUS Streamlit dashboard with 5 sidebar pages: Home overview (with metric cards, recent propostas table, and extraction history section), and 4 entity detail pages (Propostas, Programas, Apoiadores, Emendas) with cross-filtering.</what-built>
  <how-to-verify>
    1. Start the dashboard: `uv run streamlit run src/dashboard/streamlit_app.py`
    2. Open http://localhost:8501 in your browser

    **Sidebar check:**
    - Verify sidebar shows exactly 5 tabs: Home, Propostas, Programas, Apoiadores, Emendas
    - There should be NO separate "Extraction History" tab (it is a section on the Home page)

    **Home page checks:**
    - Verify metric cards show row counts for all 4 entity tables
    - Verify data freshness indicator shows last extraction time
    - Verify time range selector (default 7 days) is present
    - Verify recent propostas table is visible and shows data from the last 7 days by default
    - Change time range to 14 or 30 days and verify the table updates
    - Verify extraction history section shows pipeline runs with color-coded status (green/yellow/red)
    - Verify pipeline run summary metrics (total/success/partial/failed counts)
    - Verify row counts and duration are visible in extraction history

    **Entity pages checks (navigate via sidebar):**
    - Propostas: verify search works, filter by estado/situacao, sort columns
    - Select a proposta row: verify drill-down shows related programas/apoiadores/emendas
    - Navigate to Programas: verify it auto-filters to show only the related programa
    - Navigate to Apoiadores: verify it auto-filters to related apoiadores
    - Navigate to Emendas: verify it auto-filters to related emendas
    - Click "Show all" on any page: verify it clears the filter

    **CSV export checks:**
    - On any entity page, click the CSV export button
    - Open the downloaded CSV: verify Portuguese characters (accents, cedilhas) render correctly

    **Portuguese characters:**
    - Check that names like "Sao Paulo", "Brasilia", entity names with accents render correctly throughout
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe specific issues to fix.</resume-signal>
</task>

</tasks>

<verification>
All phase success criteria verified by human:
1. Row counts per entity table displayed
2. Extraction history on home page with pipeline runs (up to 30 days, default 7)
3. Browsable data tables with search/sort/filter
4. Data freshness indicator
5. Propostas exploration with related entities
6. Deployable on Railway (config exists)
7. Portuguese characters correct
8. Sidebar has exactly 5 tabs (Home + 4 entity types) per locked decision
</verification>

<success_criteria>
User confirms "approved" after testing all dashboard functionality.
</success_criteria>

<output>
After completion, create `.planning/phases/04-data-dashboard/04-04-SUMMARY.md`
</output>
