---
phase: 04-data-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - railway.dashboard.json
  - Dockerfile.railway
autonomous: true

must_haves:
  truths:
    - "Dashboard is deployable on Railway alongside the existing API service"
    - "Existing FastAPI deployment is unaffected by dashboard deployment config"
  artifacts:
    - path: "railway.dashboard.json"
      provides: "Railway config for dashboard service with Streamlit start command"
    - path: "Dockerfile.railway"
      provides: "Updated Dockerfile with streamlit dependency support"
  key_links:
    - from: "railway.dashboard.json"
      to: "src/dashboard/streamlit_app.py"
      via: "Streamlit start command for Railway deployment"
      pattern: "streamlit.*run|dashboard"
---

<objective>
Configure Railway deployment so the Streamlit dashboard can run alongside the existing FastAPI service as a separate Railway service.

Purpose: Ensures the dashboard is deployable to production on Railway without breaking the existing API deployment.

Output: Railway deployment config for dashboard service, updated Dockerfile supporting both services.
</objective>

<execution_context>
@/Users/pauloloureiro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pauloloureiro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-data-dashboard/04-CONTEXT.md
@.planning/phases/04-data-dashboard/04-RESEARCH.md
@.planning/phases/04-data-dashboard/04-01-SUMMARY.md
@railway.json
@Dockerfile.railway
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Railway deployment for Streamlit dashboard</name>
  <files>
    railway.dashboard.json
    Dockerfile.railway
  </files>
  <action>
    1. The existing railway.json runs FastAPI on PORT. For Railway, the recommended approach for a second service is to create a separate service config. Do NOT modify railway.json.

       Create a `railway.dashboard.json` file that can be used for a separate Railway service deployment:
       ```json
       {
         "$schema": "https://railway.app/railway.schema.json",
         "build": {
           "builder": "DOCKERFILE",
           "dockerfilePath": "Dockerfile.railway"
         },
         "deploy": {
           "startCommand": "sh -c 'uv run streamlit run src/dashboard/streamlit_app.py --server.port ${PORT:-8501} --server.headless true --server.address 0.0.0.0'",
           "healthcheckPath": "/_stcore/health",
           "healthcheckTimeout": 100,
           "restartPolicyType": "ON_FAILURE",
           "restartPolicyMaxRetries": 3
         }
       }
       ```

    2. Update `Dockerfile.railway`:
       - Ensure streamlit is included in dependencies (it should be after `uv sync` picks up pyproject.toml changes from Plan 01).
       - Verify the Dockerfile installs all dependencies correctly. The existing Dockerfile likely uses `uv sync` which will automatically include streamlit after it was added to pyproject.toml.
       - If the Dockerfile uses a multi-stage build or copies specific files, ensure `src/dashboard/` is included.
       - EXPOSE both 8000 (FastAPI) and 8501 (Streamlit) or just use PORT variable.
       - Do NOT change the existing FastAPI start command in railway.json â€” Railway will use separate services.

    Important: Do NOT break the existing FastAPI deployment. The dashboard is a SEPARATE service on Railway that shares the same codebase and database. Both services read DATABASE_URL from environment variables.
  </action>
  <verify>
    Run `cd /Users/pauloloureiro/Desktop/Work/Sigma/Projects/Projetus && uv run streamlit run src/dashboard/streamlit_app.py --server.headless true --server.port 8501 &` and verify it starts. Then check the railway.dashboard.json file exists and is valid JSON with `python -c "import json; json.load(open('railway.dashboard.json'))"`. Kill the streamlit process after verification.
  </verify>
  <done>Railway deployment config exists for dashboard as separate service. Existing FastAPI deployment in railway.json is untouched. Dockerfile supports both services. Dashboard can be started locally with `uv run streamlit run src/dashboard/streamlit_app.py`.</done>
</task>

</tasks>

<verification>
1. railway.dashboard.json is valid JSON with correct Streamlit start command
2. Existing railway.json is unchanged (FastAPI still works)
3. Streamlit app starts locally on port 8501
4. Dockerfile.railway includes src/dashboard/ directory
</verification>

<success_criteria>
- railway.dashboard.json exists with Streamlit start command and health check config
- Existing railway.json is completely untouched
- Dockerfile supports both FastAPI and Streamlit services
- Dashboard can be started locally for testing
</success_criteria>

<output>
After completion, create `.planning/phases/04-data-dashboard/04-03-SUMMARY.md`
</output>
